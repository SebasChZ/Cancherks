@page
@model CancherksWebApp.Pages.Admin.GestionSolcitudesModel
@{
}


<section class="container px-5 py-3" >
    <h3 style="margin-bottom: 2rem;">Solicitudes</h3>
    <dropdown class="dropdown">
        <button class="btn btn-secondary dropdown-toggle custom-dropdown-button" type="button" id="dropdownInstallations" data-bs-toggle="dropdown" aria-expanded="false">
            Instalaciones
        </button>
        <ul class="dropdown-menu custom-dropdown-options" aria-labelledby="dropdownMenuButton1">
            @foreach (var installation in Model.Installations)
            {
                <li><a class="dropdown-item custom-dropdown-item" href="#">@installation.Name</a></li>
            }
        </ul>


    </dropdown>
    
    <table class="table" style="margin-top: 1rem;">
        <thead>
            <tr>
                <th scope="col">Elegir</th>
                <th scope="col">Correo</th>
                <th scope="col">Instalación</th>
                <th scope="col">Fecha</th>
                <th scope="col">Hora Inicio</th>
                <th scope="col">Hora Final</th>
                <th scope="col">Estado</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var request in Model.Requests)
            {
                <tr>
                    <td><input type="checkbox" class="custom-checkbox" name="select1" value="@request.Id"></td>
                    <td>@request.EmailRequester</td>
                    <td>@Model.Installations.FirstOrDefault(i => i.Id == request.IdInstallation)?.Name</td>
                    <td>@request.DateRequest.ToShortDateString()</td>
                    <td>@request.StartTime.ToString()</td>
                    <td>@request.EndTime.ToString()</td>
                    <td>
                        <i class="bi bi-check-circle-fill custom-success" style="cursor:pointer;"></i>
                        <i class="bi bi-trash-fill custom-danger" style="cursor:pointer;"></i>
                    </td>
                </tr>
            }
        </tbody>

    </table>


    
</section>

<modalAcept class="modal" tabindex="-1" id="acept">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ATENCIÓN!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>¿Confirma que desea aprobar esta solicitud?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary button-color" data-bs-dismiss="modal" id="btnAceptar">Aceptar</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</modalAcept>

<modalNotify class="modal" tabindex="-1" id="notify">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ATENCIÓN!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Se ha notificado al estudiante.</p>
            </div>
        </div>
    </div>
</modalNotify>


<modalReject class="modal" tabindex="-1" id="reject">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ATENCIÓN!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>¿Confirma que desea rechazar esta solicitud?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary button-color" data-bs-dismiss="modal" id="btnRechazarAceptar">Aceptar</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</modalReject>

<modalJustify class="modal" tabindex="-1" id="justify">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ATENCIÓN!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Ingrese el mensaje de justificación.</p>
                <input type="text" class="form-control" id="justificacionInput" placeholder="Escriba la justificación">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary button-color" data-bs-dismiss="modal" id="btnEnviar">Enviar</button>
            </div>
        </div>
    </div>
</modalJustify>


<!-- Alert before acepting request -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var successIcons = document.querySelectorAll('.custom-success');

        successIcons.forEach(function (icon) {
            icon.addEventListener('click', function () {
                var aceptarModal = new bootstrap.Modal(document.getElementById('acept'));
                aceptarModal.show();
            });
        });
    });
</script>

<!-- Alert before rejecting  request -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var successIcons = document.querySelectorAll('.custom-danger');

        successIcons.forEach(function (icon) {
            icon.addEventListener('click', function () {
                var aceptarModal = new bootstrap.Modal(document.getElementById('reject'));
                aceptarModal.show();
            });
        });
    });
</script>

<!-- Notify after acepting the request -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var btnAceptar = document.getElementById('btnAceptar');
       
        btnAceptar.addEventListener('click', function () {
            
            var aceptarModal = new bootstrap.Modal(document.getElementById('acept'));
            
            aceptarModal.hide();
            setTimeout(function () {
                var notificarModal = new bootstrap.Modal(document.getElementById('notify'));
                notificarModal.show();
            }, 200); 
        });
    });
</script>

<!-- Justify after rejecting the request -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var btnRechazarAceptar = document.getElementById('btnRechazarAceptar');

        btnRechazarAceptar.addEventListener('click', function () {
           
            var rechazarModal = new bootstrap.Modal(document.getElementById('reject'));
            
            rechazarModal.hide();

            setTimeout(function () {
                var justificarModal = new bootstrap.Modal(document.getElementById('justify'));
                justificarModal.show();
            }, 200); 
        });
    });
</script>

<!-- Notify after sending justification message -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var btnEnviar = document.getElementById('btnEnviar');

        btnEnviar.addEventListener('click', function () {
            
            var justificarModal = new bootstrap.Modal(document.getElementById('justify'));
          
            justificarModal.hide();

            setTimeout(function () {
                var notificarModal = new bootstrap.Modal(document.getElementById('notify'));
                notificarModal.show();
            }, 200); 
        });
    });
</script>



